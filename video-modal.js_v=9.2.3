function onYouTubeIframeAPIReady() {
		if (jQuery('.video-player.youtube').length > 0) {
			jQuery('.video-player.youtube').each(function() {
					var videoId = /(youtu.be\/|v[=\/])([A-Za-z0-9_-]*)/.exec(jQuery(this).data('vid'));
					if (videoId.length > 1) {
							var modal = jQuery(this).parents('.video-modal');
							var player = new YT.Player(this, {
									height: '100%',
									width: '100%',
									videoId: videoId[2],
									playerVars: {
											color: 'white',
											iv_load_policy: 3,
											modestbranding: 1,
											rel: 0,
											showinfo: 0
									}
							});
							modal.data('ytplayer', player);
							modal.addClass('has-youtube');
					}
			});
		}
}
(function($){
	if ($('.video-player.youtube').length > 0) {
		var tag = document.createElement('script');
		tag.setAttribute('thesrc',"https://www.youtube.com/iframe_api");
		tag.setAttribute("class","trustecm");
		tag.setAttribute('trackertype',"functional");
		tag.setAttribute('fallbacktype',"trustArcFallBackMovie");
		var firstScriptTag = document.getElementsByTagName('script')[0];
		firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
	}

	$(document).ready(function() {
		if($('.video-player.custom').length > 0){
			var cld = cloudinary.Cloudinary.new({ cloud_name: drupalSettings.cloud_name });
			var useAnalytics = false;
			// Initialize players
			if(window.ga){ //check if analytics are ready
				useAnalytics = true;
				var players = cld.videoPlayers('.cld-video-player', {
					autoplay: false,
					controls: true,
					analytics: useAnalytics
				});
			}else{ //analytics not ready yet
				var players;
				setTimeout(function(){ //try again in .25 sec
					var useAnalytics = false;
					if(window.ga){
						useAnalytics = true;
					}
					players = cld.videoPlayers('.cld-video-player', {
						autoplay: false,
						controls: true,
						analytics: useAnalytics
					});
				},250);
			}


		// 	jwplayer.key=drupalSettings.jwplayer;
		// 	$('.video-player.custom').each(function() {
		// 		var player = jwplayer(this),
		// 				file = $(this).data('vid');
		// 		$(this).parents('.video-modal').data('jwplayer', player).addClass('has-jwplayer');

		// 		if ($('html').hasClass('ie11') || $('html').hasClass('ie10') || $('html').hasClass('ie9') || $('html').hasClass('ie')) {
		// 			file = file.replace(/upload\/.*?\/v/, 'upload/v');
		// 		}

		// 		player.setup({
		// 			file: file,
		// 			image: $(this).data('thumb'),
		// 			width: "100%",
		// 			aspectratio:"16:9",
		// 			title: '',
		// 			description: '',
		// 			mediaid: '123456',
		// 			skin: {
		// 			name: "seven",
		// 			active: "#baab8f"
		// 			}
		// 		});
		// 	});
		}

				$('.video-modal').on('click', function() {
					$('body').removeClass('noscroll');
					$('.video-modal').removeClass('open');
					if ($(this).hasClass('has-youtube')) {
						$(this).data('ytplayer').pauseVideo();
					}else{
						$("video", $(this))[0].pause();
					}
				});
				$('.video-modal .video-wrap').on('click', function(e) {
					e.stopPropagation();
				});

				$(document).on('keyup', function(e) {
					var keycode = e.keyCode || e.which || e.key;
					if (keycode == 27 || keycode == "27" || keycode === 'Escape' || keycode === "Esc" ) { //escape key
						$('.video-modal.open .close').click();
					}
				});
				$('.video-modal .close').on('click', function(e) {
					e.preventDefault();
					var modal = $(this).parents('.video-modal');
					modal.removeClass('open');
					$('body').removeClass('noscroll');
					if (modal.hasClass('has-youtube')) {
						modal.data('ytplayer').pauseVideo();
					}else{
						$("video", modal)[0].pause();
					}
					$(positionBeforeModal).focus();
				});
				$('[data-video-modal]').on('click', function(e) {
					positionBeforeModal = $(this);
					e.preventDefault();
					e.stopPropagation();
					var modal = $($(this).data('video-modal'));
					var closeBtn = $($(this).data('video-modal') + " .close");
					modal.addClass('open');
					$('body').addClass('noscroll');

					if (modal.hasClass('has-youtube')) {
						$($(this).data('video-modal')).data('ytplayer').seekTo(0, true);
						$($(this).data('video-modal')).data('ytplayer').playVideo();
					}else{
						$("video", modal)[0].play();
					}
					var focusableEls = modal[0].querySelectorAll('a[href], button, textarea, input[type="text"], input[type="radio"], input[type="checkbox"], select');
					firstFocusableEl = focusableEls[0];
					lastFocusableEl = focusableEls[focusableEls.length - 1];
					firstFocusableEl.focus();

					var KEYCODE_TAB = 9;
					modal[0].addEventListener('keydown', function(e) {
						var focusableEls = modal[0].querySelectorAll('a[href], button, textarea, input[type="text"], input[type="radio"], input[type="checkbox"], select');
						firstFocusableEl = focusableEls[0];
						lastFocusableEl = focusableEls[focusableEls.length - 1];
							if (e.key === 'Tab' || e.keyCode === KEYCODE_TAB) {
								if ( e.shiftKey ) /* shift + tab */ {
									if (document.activeElement === firstFocusableEl) {
										lastFocusableEl.focus();
										e.preventDefault();
									}
								} else /* tab */ {
									if (document.activeElement === lastFocusableEl) {
										firstFocusableEl.focus();
										e.preventDefault();
									}
								}
							}
					});
				});
	});
})(jQuery);
var firstFocusableEl, lastFocusableEl, positionBeforeModal;

var mytest;
